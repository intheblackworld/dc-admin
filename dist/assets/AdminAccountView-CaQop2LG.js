import{d as ie,u as ue,r as g,a as b,y as re,V as de,a0 as ce,v as pe,c as ge,b as d,e as a,w as i,f as k,k as p,G as T,B as h,h as S,M as ve,p as me,W as fe,O as G,n as m,z as F,A as _e,a1 as ye,a2 as he,a3 as we,o as O,a4 as be,_ as ke}from"./index-B3v5CdMq.js";const Ce={class:"admin-account-page"},xe={class:"search-item"},Ae={class:"search-item"},Se={class:"search-item"},Ge={class:"search-item"},Ue={class:"search-buttons"},Ie={class:"action-buttons"},Ne=ie({__name:"AdminAccountView",setup(Ve){const u=ue(),U=g(null),I=g(!1),N=g(!1),w=g([]),q=g([]),f=g({id:"",account_name:"",role_id:"",status:"",is_test:"",create_time:"",update_time:"",google_status:"0"}),y=g(!1),C=g(!1),x=g(!1),v=g(!1),V=g(""),z=b({}),D=b({}),_=b({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,30,50],onChange:t=>{_.page=t,c()},onUpdatePageSize:t=>{_.pageSize=t,_.page=1,o.page_limit=t,c()}}),o=b({page:1,page_limit:10,account_name:"",role_id:null,status:null}),l=b({id:"",account_name:"",password:"",role_id:"",status:"1"}),R=b({account_name:{required:!0,message:"請輸入帳號名稱",trigger:"blur"},role_id:{required:!0,message:"請選擇角色",trigger:"change"},status:{required:!0,message:"請選擇帳號狀態",trigger:"change"}}),B=[{label:"啟用",value:"1"},{label:"禁用",value:"0"}],E=[{label:"10條/頁",value:10},{label:"20條/頁",value:20},{label:"30條/頁",value:30},{label:"50條/頁",value:50}],L=g([]);re(async()=>{await j(),c()});async function j(){try{const t=await de(1,100);t.status===0?(q.value=t.data.list,L.value=t.data.list.map(e=>({label:e.name,value:e.id}))):u.error(t.message||"獲取角色列表失敗")}catch(t){console.error("加載角色列表失敗:",t),u.error("獲取角色列表時發生錯誤")}}const W=[{title:"ID",key:"id",width:80},{title:"帳號名稱",key:"account_name",width:150},{title:"角色",key:"role_id",width:150,render(t){const e=q.value.find(s=>s.id===t.role_id);return e?e.name:t.role_id}},{title:"創建時間",key:"create_time",width:180},{title:"更新時間",key:"update_time",width:180},{title:"帳號狀態",key:"status",width:120,render(t){const e=t.status==="1"?"啟用":"禁用",s=t.status==="1"?"#18a058":"#d03050";return m("div",{style:{display:"flex",alignItems:"center"}},[m(F,{value:t.status==="1",loading:z[t.id]===!0,onUpdateValue:r=>{$(t.id,r?"1":"0")},railStyle:()=>({background:t.status==="1"?"#18a058":"#d03050"})}),m("span",{style:{marginLeft:"8px",color:s}},e)])}},{title:"Google 驗證",key:"google_status",width:120,render(t){const e=t.google_status||"0",s=e==="1"?"已開啟":"已關閉",r=e==="1"?"#18a058":"#d03050";return m("div",{style:{display:"flex",alignItems:"center"}},[m(F,{value:e==="1",loading:D[t.id]===!0,onUpdateValue:()=>{H(t)},railStyle:()=>({background:e==="1"?"#18a058":"#d03050"})}),m("span",{style:{marginLeft:"8px",color:r}},s)])}},{title:"操作",key:"actions",width:150,fixed:"right",render(t){return m(_e,{justify:"center",align:"center"},{default:()=>[m(h,{size:"small",type:"primary",ghost:!0,onClick:()=>Y(t)},{default:()=>"編輯"}),m(h,{size:"small",type:"error",ghost:!0,onClick:()=>te(t.id)},{default:()=>"刪除"})]})}}];async function c(){I.value=!0;try{const t={page:o.page,page_limit:o.page_limit,...o.account_name&&{account_name:o.account_name},...o.role_id&&{role_id:o.role_id},...o.status!==null&&{status:o.status}},e=await ce(t);e.status===0?(w.value=e.data.list,_.itemCount=e.data.total):u.error(e.message||"獲取管理員列表失敗")}catch(t){console.error("加載管理員列表失敗:",t),u.error("獲取管理員列表時發生錯誤")}finally{I.value=!1}}async function $(t,e){z[t]=!0;try{const s=await ye(t,e);if(s.status===0){u.success(e==="1"?"啟用成功":"禁用成功");const r=w.value.findIndex(A=>A.id===t);r!==-1?w.value[r].status=e:c()}else u.error(s.message||"操作失敗"),c()}catch(s){console.error("切換管理員狀態發生錯誤:",s),u.error("操作時發生錯誤"),c()}finally{z[t]=!1}}function H(t){f.value={...t,google_status:t.google_status||"0"},C.value=!0}async function J(){D[f.value.id]=!0;try{const t=f.value.google_status==="1"?"0":"1",e=await be(f.value.id,t);if(e.status===0){u.success(t==="1"?"Google 驗證開啟成功":"Google 驗證關閉成功");const s=w.value.findIndex(r=>r.id===f.value.id);if(s!==-1){const r=w.value[s];r.google_status=t}else c()}else u.error(e.message||"操作失敗"),c()}catch(t){console.error("切換 Google 驗證狀態發生錯誤:",t),u.error("操作時發生錯誤"),c()}finally{D[f.value.id]=!1,C.value=!1}}function K(){C.value=!1}const Q=t=>t.status==="0"?"inactive-row":"";function X(){v.value=!1,Z(),y.value=!0}function Y(t){v.value=!0,l.id=t.id,l.account_name=t.account_name,l.password="",l.role_id=t.role_id,l.status=t.status,y.value=!0}function Z(){var t;l.id="",l.account_name="",l.password="",l.role_id="",l.status="1",(t=U.value)==null||t.restoreValidation()}function ee(){var t;if(!v.value&&!l.password){u.error("請輸入密碼");return}(t=U.value)==null||t.validate(async e=>{if(!e){N.value=!0;try{if(v.value){const s=await he(l.id,l.password,l.role_id,l.status);s.status===0?(u.success("更新管理員成功"),y.value=!1,c()):u.error(s.message||"更新管理員失敗")}else{const s=await we(l.account_name,l.password,l.role_id);s.status===0?(u.success("創建管理員成功"),y.value=!1,c()):u.error(s.message||"創建管理員失敗")}}catch(s){u.error("操作時發生錯誤"),console.error(s)}finally{N.value=!1}}})}function te(t){V.value=t,x.value=!0}function ae(){u.warning("刪除功能未實現，API 尚未提供此功能"),x.value=!1,V.value=""}function le(){x.value=!1,V.value=""}const M=()=>{_.page=1,o.page=1,c()},se=()=>{o.account_name="",o.role_id=null,o.status=null,u.info("已清除搜尋條件"),M()};return pe(()=>o.page_limit,t=>{_.pageSize=t,_.page=1,c()}),(t,e)=>{const s=k("n-select"),r=k("n-grid-item"),A=k("n-input"),oe=k("n-grid"),P=k("n-card"),ne=k("n-data-table");return O(),ge("div",Ce,[e[21]||(e[21]=d("div",{class:"page-header"},[d("h1",null,"管理員帳號"),d("div",{class:"page-tools"},[d("div",{class:"page-breadcrumb"},"會員管理>管理員帳號")])],-1)),a(P,{class:"search-area"},{default:i(()=>[a(oe,{cols:24,"x-gap":12,"y-gap":16},{default:i(()=>[a(r,{span:6},{default:i(()=>[d("div",xe,[e[12]||(e[12]=d("div",{class:"label"},"帳號狀態",-1)),a(s,{value:o.status,"onUpdate:value":e[0]||(e[0]=n=>o.status=n),options:B,placeholder:"請選擇",clearable:""},null,8,["value"])])]),_:1}),a(r,{span:6},{default:i(()=>[d("div",Ae,[e[13]||(e[13]=d("div",{class:"label"},"帳號名稱",-1)),a(A,{value:o.account_name,"onUpdate:value":e[1]||(e[1]=n=>o.account_name=n),placeholder:"請輸入帳號名稱",clearable:""},null,8,["value"])])]),_:1}),a(r,{span:6},{default:i(()=>[d("div",Se,[e[14]||(e[14]=d("div",{class:"label"},"角色",-1)),a(s,{value:o.role_id,"onUpdate:value":e[2]||(e[2]=n=>o.role_id=n),options:L.value,placeholder:"請選擇角色",clearable:""},null,8,["value","options"])])]),_:1}),a(r,{span:6},{default:i(()=>[d("div",Ge,[e[15]||(e[15]=d("div",{class:"label"},"每頁顯示",-1)),a(s,{value:o.page_limit,"onUpdate:value":e[3]||(e[3]=n=>o.page_limit=n),options:E,placeholder:"請選擇每頁數量"},null,8,["value"])])]),_:1}),a(r,{span:24},{default:i(()=>[d("div",Ue,[a(p(h),{type:"primary",onClick:M},{default:i(()=>e[16]||(e[16]=[S("搜尋")])),_:1}),a(p(h),{onClick:se},{default:i(()=>e[17]||(e[17]=[S("清除查詢")])),_:1}),a(p(h),{type:"info",onClick:X},{default:i(()=>e[18]||(e[18]=[S("新增管理員")])),_:1})])]),_:1})]),_:1})]),_:1}),a(P,{class:"data-table-area"},{default:i(()=>[a(ne,{columns:W,data:w.value,pagination:_,bordered:!1,loading:I.value,size:"small","row-class-name":Q,stripe:""},null,8,["data","pagination","loading"])]),_:1}),a(p(T),{show:y.value,"onUpdate:show":e[9]||(e[9]=n=>y.value=n),preset:"card",title:v.value?"編輯管理員":"新增管理員",style:{width:"500px","max-width":"90%"}},{default:i(()=>[a(p(ve),{ref_key:"formRef",ref:U,model:l,rules:R,"label-placement":"left","label-width":"100px","require-mark-placement":"right-hanging"},{default:i(()=>[a(p(G),{label:"帳號名稱",path:"account_name"},{default:i(()=>[a(A,{value:l.account_name,"onUpdate:value":e[4]||(e[4]=n=>l.account_name=n),placeholder:"請輸入帳號名稱",disabled:v.value},null,8,["value","disabled"])]),_:1}),a(p(G),{label:"密碼",path:"password",required:!v.value},{default:i(()=>[a(A,{value:l.password,"onUpdate:value":e[5]||(e[5]=n=>l.password=n),type:"password",placeholder:v.value?"不修改請留空":"請輸入密碼"},null,8,["value","placeholder"])]),_:1},8,["required"]),a(p(G),{label:"角色",path:"role_id"},{default:i(()=>[a(s,{value:l.role_id,"onUpdate:value":e[6]||(e[6]=n=>l.role_id=n),options:L.value,placeholder:"請選擇角色"},null,8,["value","options"])]),_:1}),v.value?(O(),me(p(G),{key:0,label:"帳號狀態",path:"status"},{default:i(()=>[a(s,{value:l.status,"onUpdate:value":e[7]||(e[7]=n=>l.status=n),options:B,placeholder:"請選擇狀態"},null,8,["value"])]),_:1})):fe("",!0)]),_:1},8,["model","rules"]),d("div",Ie,[a(p(h),{onClick:e[8]||(e[8]=n=>y.value=!1)},{default:i(()=>e[19]||(e[19]=[S("取消")])),_:1}),a(p(h),{type:"primary",onClick:ee,loading:N.value},{default:i(()=>e[20]||(e[20]=[S("確定")])),_:1},8,["loading"])])]),_:1},8,["show","title"]),a(p(T),{show:C.value,"onUpdate:show":e[10]||(e[10]=n=>C.value=n),preset:"dialog",title:f.value.google_status==="1"?"關閉 Google 驗證":"開啟 Google 驗證",content:f.value.google_status==="1"?"確定要關閉此管理員的 Google 驗證嗎？":"確定要開啟此管理員的 Google 驗證嗎？","positive-text":"確定","negative-text":"取消",onPositiveClick:J,onNegativeClick:K},null,8,["show","title","content"]),a(p(T),{show:x.value,"onUpdate:show":e[11]||(e[11]=n=>x.value=n),preset:"dialog",title:"確認刪除",content:"確定要刪除此管理員帳號嗎？此操作無法撤銷。","positive-text":"確定","negative-text":"取消",onPositiveClick:ae,onNegativeClick:le},null,8,["show"])])}}}),De=ke(Ne,[["__scopeId","data-v-7aab8fc8"]]);export{De as default};
