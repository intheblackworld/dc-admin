import{d as te,u as se,r as f,a as R,y as le,V as oe,v as ne,c as ie,b as v,e as l,h as r,w as n,k as s,E as M,G as z,I as B,B as m,J as re,K as ue,p as L,W as F,L as y,t as w,M as de,O as U,H as P,n as b,z as pe,X as ce,Y as E,Z as ve,o as V,$ as fe,_ as me}from"./index-B3v5CdMq.js";const ge={class:"role-view"},ye={class:"search-area"},we={class:"search-item"},be={class:"action-buttons"},he={class:"action-buttons"},ke=te({__name:"RoleView",setup(Ce){const i=se(),C=f(null),S=f(!1),_=f([]),u=f({}),h=f(!1),g=f(!1),k=f(!1),x=f(!1),D=f(""),p=R({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,30,50],onChange:a=>{p.page=a,d()},onUpdatePageSize:a=>{p.pageSize=a,p.page=1,c.page_limit=a,d()}}),c=R({name:"",status:null,page:1,page_limit:10}),o=R({id:"",name:"",description:"",status:"1"}),T={name:{required:!0,message:"請輸入角色名稱",trigger:"blur"},status:{required:!0,message:"請選擇角色狀態",trigger:"change"}},q=[{label:"啟用",value:"1"},{label:"禁用",value:"2"}],O=[{label:"10條/頁",value:10},{label:"20條/頁",value:20},{label:"30條/頁",value:30},{label:"50條/頁",value:50}],I=R({});le(()=>{d()});const $=[{title:"ID",key:"id",width:100},{title:"角色名稱",key:"name",width:150},{title:"角色描述",key:"description",ellipsis:{tooltip:!0}},{title:"狀態",key:"status",width:120,render(a){const e=a.status==="1"?"#18a058":"#d03050",t=b("span",{style:{marginLeft:"8px",color:e}},a.status==="1"?"啟用":"禁用");return b("div",{style:{display:"flex",alignItems:"center"}},[b(pe,{value:a.status==="1",loading:I[a.id]===!0,onUpdateValue:N=>{W(a.id,N?"1":"2")},railStyle:()=>({background:e})}),t])}},{title:"操作",key:"actions",width:200,render(a){return b("div",{class:"table-actions"},[b(m,{size:"small",type:"primary",ghost:!0,style:"margin-right: 8px",onClick:()=>K(a.id)},{default:()=>"詳情"}),b(m,{size:"small",type:"error",ghost:!0,onClick:()=>A(a.id)},{default:()=>"刪除"})])}}];async function d(){S.value=!0;try{const a={page:p.page,page_limit:p.pageSize};c.name&&(a.name=c.name),c.status&&(a.status=c.status);const e=await oe(a.page,a.page_limit);e.status===0?(_.value=e.data.list,p.itemCount=e.data.total):i.error(e.message||"獲取角色列表失敗")}catch(a){i.error("獲取角色列表時發生錯誤"),console.error(a)}finally{S.value=!1}}ne(()=>c.page_limit,a=>{p.pageSize=a,p.page=1,d()});function G(){p.page=1,d()}function H(){c.name="",c.status=null,p.page=1,d(),i.info("已清除搜尋條件")}function J(a){p.page=a,d()}async function K(a){try{const e=await ce(a);e.status===0?(u.value=e.data,h.value=!0):i.error(e.message||"獲取角色詳情失敗")}catch(e){i.error("獲取角色詳情時發生錯誤"),console.error(e)}}async function W(a,e){I[a]=!0;try{const t=await E(a,"","",e);if(t.status===0){i.success(e==="1"?"啟用成功":"禁用成功");const N=_.value.findIndex(ae=>ae.id===a);N!==-1?_.value[N].status=e:d()}else i.error(t.message||"操作失敗"),d()}catch(t){console.error("切換角色狀態發生錯誤:",t),i.error("操作時發生錯誤"),d()}finally{I[a]=!1}}function X(){x.value=!1,Z(),g.value=!0}function Y(){x.value=!0,o.id=u.value.id,o.name=u.value.name,o.description=u.value.description||"",o.status=u.value.status,h.value=!1,g.value=!0,setTimeout(()=>{var a;(a=C.value)==null||a.validate()},100)}function Z(){var a;o.id="",o.name="",o.description="",o.status="1",(a=C.value)==null||a.restoreValidation()}function j(){var a;(a=C.value)==null||a.validate(async e=>{if(!e)try{if(x.value){const t=await E(o.id,o.name,o.description,o.status);t.status===0?(i.success("更新角色成功"),g.value=!1,d()):i.error(t.message||"更新角色失敗")}else{const t=await ve(o.name,o.description,o.status);t.status===0?(i.success("創建角色成功"),g.value=!1,d()):i.error(t.message||"創建角色失敗")}}catch(t){i.error("操作時發生錯誤"),console.error(t)}})}function A(a){D.value=a,k.value=!0}async function Q(){try{const a=await fe(D.value);a.status===0?(i.success("刪除角色成功"),d()):i.error(a.message||"刪除角色失敗")}catch(a){i.error("刪除角色時發生錯誤"),console.error(a)}finally{k.value=!1,D.value=""}}function ee(){k.value=!1,D.value=""}return(a,e)=>(V(),ie("div",ge,[e[17]||(e[17]=v("div",{class:"page-header"},[v("h1",null,"角色管理"),v("div",{class:"breadcrumb"},[v("span",null,"首頁"),r(" / "),v("span",null,"角色管理")])],-1)),l(s(M),{class:"search-card"},{default:n(()=>[v("div",ye,[v("div",we,[e[9]||(e[9]=v("span",{class:"label"},"每頁顯示:",-1)),l(s(B),{value:c.page_limit,"onUpdate:value":e[0]||(e[0]=t=>c.page_limit=t),options:O,placeholder:"請選擇每頁顯示數量"},null,8,["value"])]),l(s(m),{type:"primary",onClick:G},{default:n(()=>e[10]||(e[10]=[r("搜尋")])),_:1}),l(s(m),{onClick:H},{default:n(()=>e[11]||(e[11]=[r("清除搜尋")])),_:1}),l(s(m),{type:"info",onClick:X},{default:n(()=>e[12]||(e[12]=[r("新增角色")])),_:1})])]),_:1}),l(s(M),{class:"data-card"},{default:n(()=>[l(s(re),{columns:$,data:_.value,loading:S.value,pagination:p,"onUpdate:page":J},null,8,["data","loading","pagination"])]),_:1}),l(s(z),{show:h.value,"onUpdate:show":e[2]||(e[2]=t=>h.value=t),preset:"card",title:"角色詳情",style:{width:"500px","max-width":"90%"}},{default:n(()=>[l(s(ue),{column:1,bordered:""},{default:n(()=>[l(s(y),{label:"角色ID"},{default:n(()=>[r(w(u.value.id),1)]),_:1}),l(s(y),{label:"角色名稱"},{default:n(()=>[r(w(u.value.name),1)]),_:1}),l(s(y),{label:"角色描述"},{default:n(()=>[r(w(u.value.description||"無"),1)]),_:1}),l(s(y),{label:"角色狀態"},{default:n(()=>[r(w(u.value.status==="1"?"啟用":"禁用"),1)]),_:1}),u.value.created_at?(V(),L(s(y),{key:0,label:"創建時間"},{default:n(()=>[r(w(u.value.created_at),1)]),_:1})):F("",!0),u.value.updated_at?(V(),L(s(y),{key:1,label:"更新時間"},{default:n(()=>[r(w(u.value.updated_at),1)]),_:1})):F("",!0)]),_:1}),v("div",be,[l(s(m),{onClick:e[1]||(e[1]=t=>h.value=!1)},{default:n(()=>e[13]||(e[13]=[r("關閉")])),_:1}),l(s(m),{type:"primary",onClick:Y},{default:n(()=>e[14]||(e[14]=[r("編輯")])),_:1})])]),_:1},8,["show"]),l(s(z),{show:g.value,"onUpdate:show":e[7]||(e[7]=t=>g.value=t),preset:"card",title:x.value?"編輯角色":"新增角色",style:{width:"500px","max-width":"90%"}},{default:n(()=>[l(s(de),{ref_key:"formRef",ref:C,model:o,rules:T,"label-placement":"left","label-width":"100px","require-mark-placement":"right-hanging"},{default:n(()=>[l(s(U),{label:"角色名稱",path:"name"},{default:n(()=>[l(s(P),{value:o.name,"onUpdate:value":e[3]||(e[3]=t=>o.name=t),placeholder:"請輸入角色名稱"},null,8,["value"])]),_:1}),l(s(U),{label:"角色描述",path:"description"},{default:n(()=>[l(s(P),{value:o.description,"onUpdate:value":e[4]||(e[4]=t=>o.description=t),type:"textarea",placeholder:"請輸入角色描述",autosize:{minRows:3,maxRows:5}},null,8,["value"])]),_:1}),l(s(U),{label:"角色狀態",path:"status"},{default:n(()=>[l(s(B),{value:o.status,"onUpdate:value":e[5]||(e[5]=t=>o.status=t),options:q,placeholder:"請選擇狀態"},null,8,["value"])]),_:1})]),_:1},8,["model"]),v("div",he,[l(s(m),{onClick:e[6]||(e[6]=t=>g.value=!1)},{default:n(()=>e[15]||(e[15]=[r("取消")])),_:1}),l(s(m),{type:"primary",onClick:j},{default:n(()=>e[16]||(e[16]=[r("確定")])),_:1})])]),_:1},8,["show","title"]),l(s(z),{show:k.value,"onUpdate:show":e[8]||(e[8]=t=>k.value=t),preset:"dialog",title:"確認刪除",content:"確定要刪除此角色嗎？此操作無法撤銷。","positive-text":"確定","negative-text":"取消",onPositiveClick:Q,onNegativeClick:ee},null,8,["show"])]))}}),xe=me(ke,[["__scopeId","data-v-777cc543"]]);export{xe as default};
