import{d as ee,u as te,r as w,a as I,v as ae,y as le,D as ne,c as se,b as u,e as n,h as p,w as o,k as s,E as F,G as P,H as z,I as k,B as y,J as oe,K as re,L as f,t as _,M as ie,O as S,P as B,n as D,z as ue,Q as de,R as pe,T as me,U as ge,o as ce,_ as ve}from"./index-B3v5CdMq.js";const fe={class:"announcement-view"},ye={class:"search-area"},_e={class:"search-item"},be={class:"search-item"},we={class:"search-item"},Se={class:"search-item"},he=["innerHTML"],ke={class:"action-buttons"},De={class:"action-buttons"},Ce=ee({__name:"AnnouncementView",setup(xe){const m=te(),C=w(null),M=w(!1),x=w([]),r=w({}),h=w(!1),b=w(!1),U=w(!1),g=I({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,30,50],onChange:t=>{g.page=t,c()},onUpdatePageSize:t=>{g.pageSize=t,g.page=1,i.page_limit=t,c()}}),i=I({title:"",category:null,date_type:null,page:1,page_limit:10});ae(()=>i.page_limit,t=>{g.pageSize=t,g.page=1,c()});const a=I({id:"",title:"",content:"",category:"1",date_type:"forever",start_time:null,end_time:null}),R={title:{required:!0,message:"請輸入公告標題",trigger:"blur"},category:{required:!0,message:"請選擇公告分類",trigger:"change"},date_type:{required:!0,message:"請選擇時間類型",trigger:"change"},start_time:{required:!0,type:"number",message:"請選擇開始時間",trigger:["change","blur"],validator:(t,e)=>(console.log("驗證開始時間:",e),!!e)},end_time:{required:!0,type:"number",message:"請選擇結束時間",trigger:["change","blur"],validator:(t,e)=>(console.log("驗證結束時間:",e),!!e)},content:{required:!0,message:"請輸入公告內容",trigger:"blur"}},T=[{label:"網站公告",value:"1"},{label:"遊戲維護",value:"2"},{label:"銀行維護",value:"3"}],L=[{label:"永久",value:"forever"},{label:"時間區間",value:"range"}],E=[{label:"10條/頁",value:10},{label:"20條/頁",value:20},{label:"30條/頁",value:30},{label:"50條/頁",value:50}],$=I({});le(()=>{c()});const H=[{title:"ID",key:"id",width:80},{title:"公告標題",key:"title",ellipsis:{tooltip:!0}},{title:"公告分類",key:"category",width:100,render(t){return q(t.category.toString())}},{title:"時間類型",key:"date_type",width:100,render(t){return V(t.date_type)}},{title:"創建時間",key:"created_at",width:160},{title:"創建者",key:"admin_name",width:120},{title:"狀態",key:"status",width:100,render(t){console.log("狀態:",t.status);const e=t.status=="1"?"#18a058":"#d03050",l=D("span",{style:{marginLeft:"8px",color:e}},t.status==="1"?"啟用中":"已停用");return D("div",{style:{display:"flex",alignItems:"center"}},[D(ue,{value:t.status==="1",loading:$[t.id]===!0,onUpdateValue:d=>{Q(t.id,d?"1":"0")},railStyle:()=>({background:e})}),l])}},{title:"操作",key:"actions",width:120,render(t){return D("div",{class:"table-actions"},[D(y,{size:"small",type:"primary",ghost:!0,onClick:()=>K(t.id)},{default:()=>"詳情"})])}}];async function c(){M.value=!0;try{const t=i.title||void 0,e=i.category!==null?Number(i.category):void 0,l=i.date_type||void 0,d=await ne(g.page,g.pageSize,t,e,l);d.status===0?(x.value=d.data.list,g.itemCount=d.data.total):m.error(d.message||"獲取公告列表失敗")}catch(t){m.error("獲取公告列表時發生錯誤"),console.error(t)}finally{M.value=!1}}function O(){g.page=1,c()}function G(){i.title="",i.category=null,i.date_type=null,g.page=1,c()}function J(t){g.page=t,c()}async function K(t){try{const e=await de(t);e.status===0?(r.value=e.data,h.value=!0):m.error(e.message||"獲取公告詳情失敗")}catch(e){m.error("獲取公告詳情時發生錯誤"),console.error(e)}}async function Q(t,e){console.log(`切換公告狀態: ID=${t}, 新狀態=${e}`),$[t]=!0;try{const l=await pe(t,e);if(l.status===0){m.success(e==="1"?"啟用成功":"停用成功");const d=x.value.findIndex(v=>v.id===t);d!==-1?x.value[d].status=e:c()}else m.error(l.message||"操作失敗"),c()}catch(l){console.error("切換公告狀態發生錯誤:",l),m.error("操作時發生錯誤"),c()}finally{$[t]=!1}}function Y(){U.value=!1,W(),b.value=!0}function j(){U.value=!0,a.id=r.value.id,a.title=r.value.title,a.content=r.value.content,a.category=r.value.category.toString(),a.date_type=r.value.date_type,r.value.start_time&&r.value.start_time!=="0000-00-00 00:00:00"?(a.start_time=new Date(r.value.start_time).getTime(),console.log("設置開始時間:",a.start_time)):a.start_time=null,r.value.end_time&&r.value.end_time!=="0000-00-00 00:00:00"?(a.end_time=new Date(r.value.end_time).getTime(),console.log("設置結束時間:",a.end_time)):a.end_time=null,h.value=!1,b.value=!0,setTimeout(()=>{var t;(t=C.value)==null||t.validate()},100)}function W(){var t;a.id="",a.title="",a.content="",a.category="1",a.date_type="forever",a.start_time=null,a.end_time=null,(t=C.value)==null||t.restoreValidation()}function X(){var t;console.log("提交表單時的數據:",a),console.log("開始時間:",a.start_time,typeof a.start_time),console.log("結束時間:",a.end_time,typeof a.end_time),(t=C.value)==null||t.validate(async e=>{if(console.log("表單驗證結果:",e),!e){let l="",d="";if(a.start_time)l=A(new Date(a.start_time));else{m.error("請選擇開始時間");return}if(a.end_time)d=A(new Date(a.end_time));else{m.error("請選擇結束時間");return}console.log("格式化後的時間:",l,d);try{if(U.value){const v=parseInt(a.id),N=await me(v,a.title,a.content,a.category,a.date_type,l,d);N.status===0?(m.success("更新公告成功"),b.value=!1,c()):m.error(N.message||"更新公告失敗")}else{const v=await ge(a.title,a.content,a.category,a.date_type,l,d);v.status===0?(m.success("創建公告成功"),b.value=!1,c()):m.error(v.message||"創建公告失敗")}}catch(v){m.error("操作時發生錯誤"),console.error(v)}}})}function A(t){const e=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getDate()).padStart(2,"0"),v=String(t.getHours()).padStart(2,"0"),N=String(t.getMinutes()).padStart(2,"0"),Z=String(t.getSeconds()).padStart(2,"0");return`${e}-${l}-${d} ${v}:${N}:${Z}`}function q(t){const e=T.find(l=>l.value===t);return e?e.label:"未知"}function V(t){const e=L.find(l=>l.value===t);return e?e.label:"未知"}return(t,e)=>(ce(),se("div",fe,[e[27]||(e[27]=u("div",{class:"page-header"},[u("h1",null,"公告管理"),u("div",{class:"breadcrumb"},[u("span",null,"首頁"),p(" / "),u("span",null,"公告管理")])],-1)),n(s(F),{class:"search-card"},{default:o(()=>[u("div",ye,[u("div",_e,[e[16]||(e[16]=u("span",{class:"label"},"公告標題:",-1)),n(s(z),{value:i.title,"onUpdate:value":e[0]||(e[0]=l=>i.title=l),placeholder:"請輸入公告標題",clearable:""},null,8,["value"])]),u("div",be,[e[17]||(e[17]=u("span",{class:"label"},"公告分類:",-1)),n(s(k),{value:i.category,"onUpdate:value":e[1]||(e[1]=l=>i.category=l),options:T,placeholder:"請選擇分類",clearable:""},null,8,["value"])]),u("div",we,[e[18]||(e[18]=u("span",{class:"label"},"時間類型:",-1)),n(s(k),{value:i.date_type,"onUpdate:value":e[2]||(e[2]=l=>i.date_type=l),options:L,placeholder:"請選擇時間類型",clearable:""},null,8,["value"])]),u("div",Se,[e[19]||(e[19]=u("span",{class:"label"},"每頁顯示:",-1)),n(s(k),{value:i.page_limit,"onUpdate:value":e[3]||(e[3]=l=>i.page_limit=l),options:E,placeholder:"請選擇每頁顯示數量"},null,8,["value"])]),n(s(y),{type:"primary",onClick:O},{default:o(()=>e[20]||(e[20]=[p("搜尋")])),_:1}),n(s(y),{onClick:G},{default:o(()=>e[21]||(e[21]=[p("清除搜尋")])),_:1}),n(s(y),{type:"info",onClick:Y},{default:o(()=>e[22]||(e[22]=[p("新增公告")])),_:1})])]),_:1}),n(s(F),{class:"data-card"},{default:o(()=>[n(s(oe),{columns:H,data:x.value,loading:M.value,pagination:g,"onUpdate:page":J},null,8,["data","loading","pagination"])]),_:1}),n(s(P),{show:h.value,"onUpdate:show":e[5]||(e[5]=l=>h.value=l),preset:"card",title:"公告詳情",style:{width:"600px","max-width":"90%"}},{default:o(()=>[n(s(re),{column:1,bordered:""},{default:o(()=>[n(s(f),{label:"公告標題"},{default:o(()=>[p(_(r.value.title),1)]),_:1}),n(s(f),{label:"公告分類"},{default:o(()=>[p(_(q(r.value.category.toString())),1)]),_:1}),n(s(f),{label:"時間類型"},{default:o(()=>[p(_(V(r.value.date_type)),1)]),_:1}),n(s(f),{label:"開始時間"},{default:o(()=>[p(_(r.value.start_time),1)]),_:1}),n(s(f),{label:"結束時間"},{default:o(()=>[p(_(r.value.end_time),1)]),_:1}),n(s(f),{label:"創建者"},{default:o(()=>[p(_(r.value.admin_name),1)]),_:1}),n(s(f),{label:"創建時間"},{default:o(()=>[p(_(r.value.created_at),1)]),_:1}),n(s(f),{label:"更新時間"},{default:o(()=>[p(_(r.value.updated_at),1)]),_:1}),n(s(f),{label:"公告內容"},{default:o(()=>[u("div",{class:"announcement-content",innerHTML:r.value.content},null,8,he)]),_:1})]),_:1}),u("div",ke,[n(s(y),{onClick:e[4]||(e[4]=l=>h.value=!1)},{default:o(()=>e[23]||(e[23]=[p("關閉")])),_:1}),n(s(y),{type:"primary",onClick:j},{default:o(()=>e[24]||(e[24]=[p("編輯")])),_:1})])]),_:1},8,["show"]),n(s(P),{show:b.value,"onUpdate:show":e[15]||(e[15]=l=>b.value=l),preset:"card",title:U.value?"編輯公告":"新增公告",style:{width:"700px","max-width":"90%"}},{default:o(()=>[n(s(ie),{ref_key:"formRef",ref:C,model:a,rules:R,"label-placement":"left","label-width":"100px","require-mark-placement":"right-hanging"},{default:o(()=>[n(s(S),{label:"公告標題",path:"title"},{default:o(()=>[n(s(z),{value:a.title,"onUpdate:value":e[6]||(e[6]=l=>a.title=l),placeholder:"請輸入公告標題"},null,8,["value"])]),_:1}),n(s(S),{label:"公告分類",path:"category"},{default:o(()=>[n(s(k),{value:a.category,"onUpdate:value":e[7]||(e[7]=l=>a.category=l),options:T,placeholder:"請選擇分類"},null,8,["value"])]),_:1}),n(s(S),{label:"時間類型",path:"date_type"},{default:o(()=>[n(s(k),{value:a.date_type,"onUpdate:value":e[8]||(e[8]=l=>a.date_type=l),options:L,placeholder:"請選擇時間類型"},null,8,["value"])]),_:1}),n(s(S),{label:"開始時間",path:"start_time"},{default:o(()=>[n(s(B),{value:a.start_time,"onUpdate:value":[e[9]||(e[9]=l=>a.start_time=l),e[10]||(e[10]=l=>console.log("開始時間更新:",l))],type:"datetime",clearable:"",style:{width:"100%"},"value-format":"timestamp"},null,8,["value"])]),_:1}),n(s(S),{label:"結束時間",path:"end_time"},{default:o(()=>[n(s(B),{value:a.end_time,"onUpdate:value":[e[11]||(e[11]=l=>a.end_time=l),e[12]||(e[12]=l=>console.log("結束時間更新:",l))],type:"datetime",clearable:"",style:{width:"100%"},"value-format":"timestamp"},null,8,["value"])]),_:1}),n(s(S),{label:"公告內容",path:"content"},{default:o(()=>[n(s(z),{value:a.content,"onUpdate:value":e[13]||(e[13]=l=>a.content=l),type:"textarea",placeholder:"請輸入公告內容",autosize:{minRows:5,maxRows:10}},null,8,["value"])]),_:1})]),_:1},8,["model"]),u("div",De,[n(s(y),{onClick:e[14]||(e[14]=l=>b.value=!1)},{default:o(()=>e[25]||(e[25]=[p("取消")])),_:1}),n(s(y),{type:"primary",onClick:X},{default:o(()=>e[26]||(e[26]=[p("確定")])),_:1})])]),_:1},8,["show","title"])]))}}),Ne=ve(Ce,[["__scopeId","data-v-7861b7ed"]]);export{Ne as default};
